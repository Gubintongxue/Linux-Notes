# 第五章、Linux 的文件权限与目录配置

最近更新日期：20//

Linux最优秀的地方之一就在于他的多用户多任务环境。而为了让各个使用者具有较保密的文件数据，因此文件的权限管理就变的很重要了。 Linux一般将文件可存取的身份分为三个类别，分别是 owner/group/others，且三种身份各有 read/write/execute 等权限。若管理不当，你的Linux主机将会变的很“不苏湖！@_@”。另外，你如果首次接触Linux的话，那么， 在Linux下面这么多的目录/文件，到底每个目录/文件代表什么意义呢？下面我们就来一一介绍呢！

### 5.1 使用者与群组

在Linux中，理解文件的拥有者和权限非常重要，尤其是在多用户、多任务的系统环境下。这一节将介绍使用者、群组以及其他用户的基本概念，帮助你更好地管理和保护文件。

#### 文件拥有者

Linux系统中的每个文件都有一个拥有者，这个拥有者可以是任何一个系统用户。由于Linux是一个多用户系统，常常有多人同时使用同一台主机。因此，文件拥有者的概念对保护个人隐私和设置工作环境非常重要。

例如，如果你将一封电子邮件情书保存为文件，并希望只有你自己能够访问和修改它，那么你可以将该文件设置为只有文件拥有者（你自己）可以读取和修改。这种设置能有效保护你的隐私。

#### 群组概念

群组的设置在团队开发中非常有用。例如，假设有两个项目组：projecta和projectb。每个项目组内有不同的成员，两个项目组之间有竞争关系，但需要提交同一份报告。你希望每组的成员能够互相修改组内的文件，而其他组的成员则不能查看这些文件。这时，你可以通过文件权限设置，实现以下目标：

- 限制非本群组的成员查看文件。
- 允许本群组成员修改文件。
- 对私人文件，可以设置为群组内成员也无法访问。

此外，如果teacher这个帐号需要同时管理projecta和projectb两个项目组，你可以将teacher设置为这两个群组的成员，从而拥有访问两个群组文件的权限。

#### 其他人的概念

其他人指的是不属于文件拥有者或群组的用户。例如，张小猪是另一个家庭的成员，与王家没有关系，除非王家允许他进入，否则他无法访问王家的文件。这类似于Linux中的“其他人（Others）”的概念。

#### 权限示意图

在Linux中，每个文件都有三种身份的权限：User（用户）、Group（群组）和Others（其他人）。以下是一个示意图：

- 王三毛是文件的拥有者，他属于王大毛这个群组。
- 张小猪相对于王三毛，则是一个“其他人（Others）”。

在Linux系统中，root用户被称为“万能的天神”，拥有所有文件和目录的访问权限。

#### 使用者身份与群组的重要性

使用者身份和群组在Linux系统中非常重要，它们帮助你管理多任务环境，并保护个人和团队的文件。更多关于身份和群组的设置将在第十三章介绍。

#### Linux使用者身份与群组记录的文件

在Linux系统中，所有用户和群组的信息记录在以下文件中：

- /etc/passwd：记录系统所有用户的信息。
- /etc/shadow：记录用户的密码信息。
- /etc/group：记录系统的群组信息。

这些文件是系统账号、密码和群组信息的集中地，不能随意删除。在第十三章中将详细介绍这些文件的格式和更多设置。

#### 总结

理解使用者和群组的概念对于有效管理Linux系统至关重要。通过适当设置文件的权限，你可以确保个人隐私和团队协作的安全性。Linux系统提供了强大的工具和灵活的权限设置来帮助你实现这些目标。

### 5.2 Linux 文件权限概念

了解了Linux的使用者和群组之后，接下来要探讨文件权限的设置，这对于初学者来说是一个重要的关卡。文件的权限与属性在Linux中扮演着至关重要的角色，掌握这些概念能让你更好地管理系统文件，避免“Permission deny”的错误。

### 5.2.1 Linux文件属性

要了解文件属性，首先要熟悉`ls`指令，这是查看文件信息的重要命令。使用`ls -al`可以显示文件的详细权限和属性，包括隐藏文件。以下是一个示例输出及各字段的解释：

```
shell复制代码[dmtsai@study ~]$ su -
Password:
[root@study ~]# ls -al
total 48
dr-xr-x---.  5    root     root    4096  May 29 16:08 .
dr-xr-xr-x. 17    root     root    4096  May  4 17:56 ..
-rw-------.  1    root     root    1816  May  4 17:57 anaconda-ks.cfg
-rw-------.  1    root     root     927  Jun  2 11:27 .bash_history
-rw-r--r--.  1    root     root      18  Dec 29  2013 .bash_logout
-rw-r--r--.  1    root     root     176  Dec 29  2013 .bash_profile
-rw-r--r--.  1    root     root     176  Dec 29  2013 .bashrc
drwxr-xr-x.  3    root     root      17  May  6 00:14 .config
drwx------.  3    root     root      24  May  4 17:59 .dbus
-rw-r--r--.  1    root     root    1864  May  4 18:01 initial-setup-ks.cfg
```

- **第一栏**: 文件类型与权限（共10个字符）
  - 第一个字符表示文件类型：
    - `d`: 目录
    - `-`: 文件
    - `l`: 链接文件
    - `b`: 块设备文件
    - `c`: 字符设备文件
  - 后续字符表示权限，分为三组，每组三个字符，分别表示所有者、群组和其他人的权限：
    - `r`: 可读
    - `w`: 可写
    - `x`: 可执行
- **第二栏**: 文件名链接数
- **第三栏**: 文件拥有者
- **第四栏**: 文件所属群组
- **第五栏**: 文件大小（字节）
- **第六栏**: 修改日期
- **第七栏**: 文件名

### 5.2.2 如何改变文件属性与权限

修改文件权限和属性的命令有三个主要命令：

1. **chgrp**: 改变文件所属群组
2. **chown**: 改变文件拥有者
3. **chmod**: 改变文件的权限

#### 改变所属群组，chgrp

使用`chgrp`命令改变文件或目录的群组：

```
shell复制代码[root@study ~]# chgrp users initial-setup-ks.cfg
[root@study ~]# ls -l
-rw-r--r--. 1 root users 1864 May  4 18:01 initial-setup-ks.cfg
```

#### 改变文件拥有者，chown

使用`chown`命令改变文件或目录的拥有者，可以同时改变群组：

```
shell复制代码[root@study ~]# chown bin initial-setup-ks.cfg
[root@study ~]# ls -l
-rw-r--r--. 1 bin users 1864 May  4 18:01 initial-setup-ks.cfg

[root@study ~]# chown root:root initial-setup-ks.cfg
[root@study ~]# ls -l
-rw-r--r--. 1 root root 1864 May  4 18:01 initial-setup-ks.cfg
```

#### 改变权限，chmod

使用`chmod`命令可以通过数字或者符号改变文件权限。

**数字类型改变文件权限**：

权限字符与数字对应表：

- `r`: 4
- `w`: 2
- `x`: 1

每种身份（所有者、群组、其他人）的权限数值是累加的，例如`-rwxrwx---`对应的数字是770：

```
shell复制代码[root@study ~]# chmod 777 .bashrc
[root@study ~]# ls -al .bashrc
-rwxrwxrwx. 1 root root 176 Dec 29  2013 .bashrc
```

**符号类型改变文件权限**：

使用符号`u`（用户）、`g`（群组）、`o`（其他人）、`a`（所有）与`+`（增加）、`-`（删除）、`=`（设置）来改变权限：

```
shell复制代码[root@study ~]# chmod u=rwx,go=rx .bashrc
[root@study ~]# ls -al .bashrc
-rwxr-xr-x. 1 root root 176 Dec 29  2013 .bashrc
```

### 5.2.3 目录与文件之权限意义

文件与目录的权限意义有所不同。对于文件：

- `r`: 读取文件内容
- `w`: 修改文件内容
- `x`: 执行文件

对于目录：

- `r`: 读取目录内容
- `w`: 修改目录内容，包括创建、删除、重命名文件或目录
- `x`: 进入目录

例题分析：

```
shell
复制代码
drwxr--r--  3  root  root  4096   Jun 25 08:35   .ssh
```

假设用户`vbird`不属于`root`群组：

- `vbird`只能读取目录内容，但无法进入目录，因为没有`x`权限。

```
shell
复制代码
drwxr-xr--   1 test1    testgroup    5238 Jun 19 10:25 groups/
```

假设用户`test1`对文件`ping_tsai`：

- `test1`拥有所有权限（读、写、执行）
- `testgroup`的其他成员拥有读和执行权限，但没有写权限
- 其他用户只能读取文件

### 5.2.4 Linux文件种类与扩展名

Linux文件类型：

- **普通文件（-）**: 包括纯文本文件、二进制文件、数据文件

- **目录文件（d）**: 用于存放文件和其他目录

- **链接文件（l）**: 类似Windows的快捷方式

- 设备文件

  :

  - **块设备文件（b）**: 如硬盘
  - **字符设备文件（c）**: 如键盘、鼠标

- **套接字文件（s）**: 用于网络数据传输

- **FIFO文件（p）**: 解决多个程序同时存取问题

文件名长度限制为255字节，避免使用特殊字符如`? > < ; & ! [ ] | \ ' " \`（ ） { }`。文件扩展名仅作为文件类型的提示，Linux中文件是否可执行由权限决定，而非扩展名。

理解并掌握这些文件权限和属性设置，将有助于你在Linux系统中更好地管理和保护文件，提高工作效率。

### 5.3 Linux目录配置

在了解了每个文件的相关种类与属性，以及如何更改文件属性/权限后，接下来要了解的是为什么不同的Linux发行版中的配置文件、可执行文件和目录结构都非常相似。这是因为有一个标准在规范这些内容，即Filesystem Hierarchy Standard (FHS)。

### 5.3.1 Linux目录配置的依据--FHS

FHS的主要目的是希望使用者能够了解已安装软件通常放置在哪个目录下，从而规范每个特定的目录应放置什么样的数据。FHS定义了四种类型的目录：

- **可分享的（shareable）**：可以分享给其他系统挂载使用的目录，如可执行文件和用户邮件。
- **不可分享的（unshareable）**：仅与自身机器有关的目录，如设备文件或与程序有关的socket文件。
- **不变的（static）**：不经常变动的数据，如函数库、文件说明文档和配置文件。
- **可变动的（variable）**：经常改变的数据，如日志文件和用户邮件。

FHS主要定义了以下三个层次的目录结构：

1. **根目录（/）**：与开机系统有关。
2. **/usr**：与软件安装/执行有关。
3. **/var**：与系统运行过程有关。

#### 根目录（/）的意义与内容

根目录是整个系统最重要的目录，与开机、还原、系统修复等操作有关。FHS建议根目录所在分区应尽量小，保持根目录所在的文件系统不容易出错。根目录下建议存在以下次目录：

- **/bin**：放置常用的可执行文件。
- **/boot**：放置开机所需文件。
- **/dev**：存放设备文件。
- **/etc**：存放配置文件。
- **/lib**：存放开机时用到的函数库。
- **/media**：挂载可移除设备。
- **/mnt**：临时挂载额外设备。
- **/opt**：放置第三方协力软件。
- **/run**：放置开机后产生的各项信息。
- **/sbin**：放置系统管理命令。
- **/srv**：放置服务相关数据。
- **/tmp**：存放临时文件。

此外，根目录下还可能包含以下目录：

- **/home**：存放用户主目录。
- **/lib<qual>**：存放与/lib不同格式的函数库。
- **/root**：系统管理员的主目录。
- **/lost+found**：存放文件系统错误产生的片段。
- **/proc**：虚拟文件系统，存放系统核心和进程信息。
- **/sys**：类似/proc，存放核心和硬件信息。

#### /usr 的意义与内容

/usr目录存放系统默认的软件，属于可分享和不可变动的部分。常见的次目录有：

- **/usr/bin**：存放用户可执行命令。
- **/usr/lib**：存放函数库。
- **/usr/local**：系统管理员自行安装的软件。
- **/usr/sbin**：存放非系统正常运行所需的系统命令。
- **/usr/share**：存放共享的只读数据。

#### /var 的意义与内容

/var目录主要存放常态性变动的文件，包括缓存、日志文件和程序运行产生的文件。常见的次目录有：

- **/var/cache**：存放应用程序运行过程中产生的缓存。
- **/var/lib**：存放程序运行过程中需要使用的数据文件。
- **/var/lock**：存放程序锁文件。
- **/var/log**：存放日志文件。
- **/var/mail**：存放用户邮件。
- **/var/run**：存放程序或服务启动后产生的PID文件。
- **/var/spool**：存放伫列数据。

### 5.3.2 目录树（directory tree）

在Linux中，所有的文件和目录都是由根目录开始的，形成一个树状结构。目录树的主要特性有：

- 目录树的起始点为根目录（/）。
- 每个目录不止能使用本地端的分区的文件系统，也可以使用网络上的文件系统。
- 每个文件在目录树中的文件名（包含完整路径）都是独一无二的。

以下是根目录下的常见目录及其内容：

```
shell复制代码[dmtsai@study ~]$ ls -l /
lrwxrwxrwx.   1 root root    7 May  4 17:51 bin -> usr/bin
dr-xr-xr-x.   4 root root 4096 May  4 17:59 boot
drwxr-xr-x.  20 root root 3260 Jun  2 19:27 dev
drwxr-xr-x. 131 root root 8192 Jun  2 23:51 etc
drwxr-xr-x.   3 root root   19 May  4 17:56 home
lrwxrwxrwx.   1 root root    7 May  4 17:51 lib -> usr/lib
lrwxrwxrwx.   1 root root    9 May  4 17:51 lib64 -> usr/lib64
drwxr-xr-x.   2 root root    6 Jun 10  2014 media
drwxr-xr-x.   2 root root    6 Jun 10  2014 mnt
drwxr-xr-x.   3 root root   15 May  4 17:54 opt
dr-xr-xr-x. 154 root root    0 Jun  2 11:27 proc
dr-xr-x---.   5 root root 4096 Jun  3 00:04 root
drwxr-xr-x.  33 root root  960 Jun  2 19:27 run
lrwxrwxrwx.   1 root root    8 May  4 17:51 sbin -> usr/sbin
drwxr-xr-x.   2 root root    6 Jun 10  2014 srv
dr-xr-xr-x.  13 root root    0 Jun  2 19:27 sys
drwxrwxrwt.  12 root root 4096 Jun  3 19:48 tmp
drwxr-xr-x.  13 root root 4096 May  4 17:51 usr
drwxr-xr-x.  22 root root 4096 Jun  2 19:27 var
```

### 5.3.3 绝对路径与相对路径

在Linux中，文件路径可以分为绝对路径和相对路径：

- **绝对路径**：由根目录（/）开始写起的文件名或目录名称，例如 /home/dmtsai/.bashrc。
- **相对路径**：相对于当前路径的文件名写法，例如 ./home/dmtsai 或 ../../home/dmtsai。

相对路径是以当前所在路径的相对位置来表示的。例如，从 /home 切换到 /var/log 目录，可以使用相对路径 `../var/log`。

特殊目录：

- **.**：代表当前目录，可以用 ./ 表示。
- **..**：代表上一层目录，可以用 ../ 表示。

### 5.3.4 CentOS 的观察

可以使用 `uname` 和 `lsb_release` 命令检查Linux核心和操作系统的版本。安装 `lsb_release` 需要网络连接，可以通过以下命令安装：

```
shell
复制代码
[root@study ~]# yum install redhat-lsb
```

安装后使用以下命令查看LSB版本：

```
shell
复制代码
[root@study ~]# lsb_release -a
```

了解这些目录配置和路径概念将有助于更好地管理和使用Linux系统。

## 5.4 重点回顾

- Linux的每个文件中，可分别给予使用者、群组与其他人三种身份个别的 rwx 权限；
- 群组最有用的功能之一，就是当你在团队开发资源的时候，且每个帐号都可以有多个群组的支持；
- 利用ls -l显示的文件属性中，第一个字段是文件的权限，共有十个位，第一个位是文件类型， 接下来三个为一组共三组，为使用者、群组、其他人的权限，权限有r,w,x三种；
- 如果文件名之前多一个“ . ”，则代表这个文件为“隐藏文件”；
- 若需要root的权限时，可以使用 su - 这个指令来切换身份。处理完毕则使用 exit 离开 su 的指令环境。
- 更改文件的群组支持可用chgrp，修改文件的拥有者可用chown，修改文件的权限可用chmod
- chmod修改权限的方法有两种，分别是符号法与数字法，数字法中r,w,x分数为4,2,1；
- 对文件来讲，权限的性能为：
  - r：可读取此一文件的实际内容，如读取文本文件的文字内容等；
  - w：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）；
  - x：该文件具有可以被系统执行的权限。
- 对目录来说，权限的性能为：
  - r （read contents in directory）
  - w （modify contents of directory）
  - x （access directory）
- 要开放目录给任何人浏览时，应该至少也要给予r及x的权限，但w权限不可随便给；
- 能否读取到某个文件内容，跟该文件所在的目录权限也有关系 （目录至少需要有 x 的权限）。
- Linux文件名的限制为：单一文件或目录的最大容许文件名为 255 个英文字符或 128 个中文字符；
- 根据FHS的官方文件指出， 他们的主要目的是希望让使用者可以了解到已安装软件通常放置于那个目录下
- FHS订定出来的四种目录特色为：shareable, unshareable, static, variable等四类；
- FHS所定义的三层主目录为：/, /var, /usr三层而已；
- 绝对路径文件名为从根目录 / 开始写起，否则都是相对路径的文件名。